imports:
    - { resource: slots.yml }

parameters:
    cabbage.field.name_generator.type_suffix_map:
        boolean: boolean
        keyword: keyword
        identifier: identifier

services:
    cabbage.http.client:
        class: Cabbage\Core\Http\Client

    cabbage.gateway:
        class: Cabbage\Core\Gateway
        arguments:
            - '@cabbage.http.client'

    cabbage.configurator:
        class: Cabbage\Core\Configurator
        arguments:
            - '@cabbage.http.client'

    cabbage.field_type.data_mapper.checkbox:
        class: Cabbage\Core\FieldType\DataMapper\Checkbox

    cabbage.field_type.data_mapper.text_line:
        class: Cabbage\Core\FieldType\DataMapper\TextLine

    cabbage.field_type.data_mapper.unmapped:
        class: Cabbage\Core\FieldType\DataMapper\Unmapped

    cabbage.field_type.data_mapper_registry:
        class: Cabbage\Core\FieldType\DataMapperRegistry
        arguments:
            -
                ezboolean: '@cabbage.field_type.data_mapper.checkbox'
                ezstring: '@cabbage.field_type.data_mapper.text_line'
                ezrichtext: '@cabbage.field_type.data_mapper.unmapped'
                ezpage: '@cabbage.field_type.data_mapper.unmapped'
                ezkeyword: '@cabbage.field_type.data_mapper.unmapped'
                ezinisetting: '@cabbage.field_type.data_mapper.unmapped'
                eztext: '@cabbage.field_type.data_mapper.unmapped'
                ezemail: '@cabbage.field_type.data_mapper.unmapped'
                ezuser: '@cabbage.field_type.data_mapper.unmapped'
                ezimage: '@cabbage.field_type.data_mapper.unmapped'
                ezpackage: '@cabbage.field_type.data_mapper.unmapped'
                ezurl: '@cabbage.field_type.data_mapper.unmapped'

    cabbage.document.mapper.content_field.name_generator:
        class: Cabbage\Core\Document\Mapper\ContentField\NameGenerator

    cabbage.document.mapper.content_field.mapper:
        class: Cabbage\Core\Document\Mapper\ContentField\Mapper
        arguments:
            - '@cabbage.field_type.data_mapper_registry'
            - '@cabbage.document.mapper.content_field.name_generator'

    cabbage.document.id_generator:
        class: Cabbage\Core\Document\Mapper\IdGenerator

    cabbage.document.mapper:
        class: Cabbage\Core\Document\Mapper
        arguments:
            - '@ezpublish.spi.persistence.location_handler'
            - '@ezpublish.spi.persistence.content_type_handler'
            - '@cabbage.document.mapper.content_field.mapper'
            - '@cabbage.document.id_generator'

    cabbage.document.serializer.index_resolver:
        class: Cabbage\Core\Document\Serializer\IndexResolver

    cabbage.document.serializer.field_serializer.value_mapper.visitor.boolean:
        class: Cabbage\Core\Document\Serializer\FieldSerializer\ValueMapper\Visitor\Boolean

    cabbage.document.serializer.field_serializer.value_mapper.visitor.keyword:
        class: Cabbage\Core\Document\Serializer\FieldSerializer\ValueMapper\Visitor\Keyword

    cabbage.document.serializer.field_serializer.value_mapper.visitor.identifier:
        class: Cabbage\Core\Document\Serializer\FieldSerializer\ValueMapper\Visitor\Identifier

    cabbage.document.serializer.field_serializer.value_mapper:
        class: Cabbage\Core\Document\Serializer\FieldSerializer\ValueMapper
        arguments:
            -
                - '@cabbage.document.serializer.field_serializer.value_mapper.visitor.boolean'
                - '@cabbage.document.serializer.field_serializer.value_mapper.visitor.keyword'
                - '@cabbage.document.serializer.field_serializer.value_mapper.visitor.identifier'

    cabbage.document.serializer.field_serializer.typed_name_generator:
        class: Cabbage\Core\Document\Serializer\FieldSerializer\TypedNameGenerator
        arguments:
            - '%cabbage.field.name_generator.type_suffix_map%'

    cabbage.document.serializer.field_serializer:
        class: Cabbage\Core\Document\Serializer\FieldSerializer
        arguments:
            - '@cabbage.document.serializer.field_serializer.typed_name_generator'
            - '@cabbage.document.serializer.field_serializer.value_mapper'

    cabbage.document.serializer:
        class: Cabbage\Core\Document\Serializer
        arguments:
            - '@cabbage.document.serializer.index_resolver'
            - '@cabbage.document.serializer.field_serializer'

    cabbage.query_translator.criterion.visitor.custom_field:
        class: Cabbage\Core\Query\Translator\Criterion\Visitor\RawField

    cabbage.query_translator.criterion.visitor.document_type:
        class: Cabbage\Core\Query\Translator\Criterion\Visitor\DocumentType

    cabbage.query_translator.criterion.visitor.content_id:
        class: Cabbage\Core\Query\Translator\Criterion\Visitor\ContentId

    cabbage.query_translator.criterion.converter:
        class: Cabbage\Core\Query\Translator\Criterion\Converter
        arguments:
            -
                - '@cabbage.query_translator.criterion.visitor.custom_field'
                - '@cabbage.query_translator.criterion.visitor.document_type'
                - '@cabbage.query_translator.criterion.visitor.content_id'

    cabbage.query.translator:
        class: Cabbage\Core\Query\Translator
        arguments:
            - '@cabbage.query_translator.criterion.converter'

    cabbage.query.target_resolver:
        class: Cabbage\Core\Query\TargetResolver

    cabbage.result_extractor:
        class: Cabbage\Core\ResultExtractor

    cabbage.handler:
        class: Cabbage\Core\Handler
        arguments:
            - '@cabbage.gateway'
            - '@cabbage.document.mapper'
            - '@cabbage.document.serializer'
            - '@cabbage.query.translator'
            - '@cabbage.query.target_resolver'
            - '@cabbage.result_extractor'

    ezpublish.spi.search_engine:
        alias: cabbage.handler
